# Browser Cluster

**Browser Cluster** æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€åˆ†å¸ƒå¼çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–é›†ç¾¤ç³»ç»Ÿï¼ŒåŸºäº Playwright å’Œ FastAPI æ„å»ºã€‚å®ƒæ”¯æŒå¤§è§„æ¨¡å¹¶å‘ç½‘é¡µæŠ“å–ã€æˆªå›¾ã€PDF ç”ŸæˆåŠè‡ªåŠ¨åŒ–æ“ä½œï¼Œå¹¶é›†æˆäº† **LLM æ™ºèƒ½è¯†åˆ« (Agent)** é©±åŠ¨çš„ç»“æ„åŒ–æå–èƒ½åŠ›ï¼Œå…·å¤‡å®Œå–„çš„ä»»åŠ¡è°ƒåº¦ã€ç»“æœç¼“å­˜ã€å¤šæ¨¡å‹ç®¡ç†å’Œä»£ç†æ± ç³»ç»Ÿã€‚

![UI Preview](admin/public/image.png)

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **ğŸ¤– LLM æ™ºèƒ½æå– (Agent)**ï¼šé›†æˆå¤§è¯­è¨€æ¨¡å‹ï¼Œæ”¯æŒå¯¹ç½‘é¡µå†…å®¹è¿›è¡Œé›¶é…ç½®çš„è‡ªåŠ¨åŒ–ç»“æ„åŒ–æå–ã€‚
- **ğŸŒ å…¨åŠŸèƒ½ä»£ç†æ± **ï¼šæ”¯æŒ HTTP/SOCKS5 ä»£ç†ç®¡ç†ï¼Œå…·å¤‡è´¦å·å¯†ç è®¤è¯ã€è¿æ¥æ‹¨æµ‹ã€åœ°ç†ä½ç½®æ ‡è¯†åŠä¼šè¯æŒä¹…åŒ–ï¼ˆSticky IPï¼‰æ§åˆ¶ã€‚
- **ğŸ­ å¤šæ¨¡å‹é©±åŠ¨**ï¼šåŸç”Ÿæ”¯æŒ OpenAI, Anthropic (Claude), Google Gemini, Ollama åŠè‡ªå®šä¹‰ OpenAI å…¼å®¹æ¥å£ï¼Œæ”¯æŒè§†è§‰è¯†åˆ«ã€‚
- **ğŸ“ æç¤ºè¯æ¨¡æ¿ç®¡ç†**ï¼šé¢„ç½®ä¸è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿ï¼Œæ”¯æŒåœ¨æŠ“å–ä»»åŠ¡ä¸­ä¸€é”®å¼•ç”¨ï¼Œå¹¶å¯å°†æˆåŠŸçš„æå–ç»éªŒä¿å­˜ä¸ºæ¨¡æ¿ã€‚
- **åˆ†å¸ƒå¼æ¶æ„**ï¼šæ”¯æŒå¤š Worker èŠ‚ç‚¹æ°´å¹³æ‰©å±•ï¼Œè½»æ¾åº”å¯¹é«˜å¹¶å‘åœºæ™¯ã€‚
- **éšèº«æ¨¡å¼**ï¼šå†…ç½® Stealth æ’ä»¶ï¼Œæœ‰æ•ˆç»•è¿‡åçˆ¬è™«æ£€æµ‹ã€‚
- **èµ„æºä¼˜åŒ–**ï¼šæ™ºèƒ½æ‹¦æˆªå›¾ç‰‡ã€åª’ä½“èµ„æºï¼Œæ˜¾è‘—æå‡æ¸²æŸ“é€Ÿåº¦ã€‚
- **API æ‹¦æˆª**ï¼šæ”¯æŒåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æå–ç‰¹å®š XHR/Fetch æ¥å£æ•°æ®ã€‚
- **å¯è§†åŒ–ç®¡ç†**ï¼šæä¾›åŸºäº Vue 3 + Element Plus çš„ç°ä»£åŒ– "Bento" é£æ ¼ç®¡ç†åå°ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šPython 3.10, FastAPI, Playwright, RabbitMQ, MongoDB, Redis
- **å‰ç«¯**ï¼šVue 3, Element Plus, Pinia, Vite
- **AI é©±åŠ¨**ï¼šLangChain/Direct API (æ”¯æŒ GPT, Claude, Gemini, WebUI ç­‰)

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

![Architecture](admin/public/architecture.png)

### æ ¸å¿ƒç»„ä»¶

- **ğŸŒ API Gateway (FastAPI)**
  - ç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£æ¥æ”¶ HTTP è¯·æ±‚ã€å‚æ•°æ ¡éªŒã€ä»»åŠ¡è°ƒåº¦åŠ **Agent è¯†åˆ«åˆ†å‘**ã€‚
  - é›†æˆ Redis ç¼“å­˜å±‚ï¼Œå¯¹é‡å¤è¯·æ±‚ç›´æ¥è¿”å›ç¼“å­˜ç»“æœã€‚
  
- **ğŸ¤– Worker Nodes (Playwright)**
  - åˆ†å¸ƒå¼æ‰§è¡Œå•å…ƒï¼Œè´Ÿè´£å¯åŠ¨æµè§ˆå™¨ã€æ¸²æŸ“é¡µé¢ã€æ‰§è¡Œ JavaScript åŠæˆªå›¾ã€‚
  - ç»“åˆåç½®å¤„ç†å™¨ï¼Œå¯¹ç½‘é¡µæ•°æ®è¿›è¡Œç»“æ„åŒ–æ¸…æ´—æˆ–ä¼ é€’ç»™ AI æ¨¡å‹ã€‚

- **ğŸ“¨ Proxy Pool Manager**
  - ç®¡ç†ä»£ç†é›†ç¾¤ï¼Œæ”¯æŒä¸»åŠ¨æ‹¨æµ‹ï¼ˆConnection Testï¼‰ï¼Œç¡®ä¿ä»»åŠ¡åˆ†é…åˆ°å¯ç”¨çš„ä»£ç†ã€‚

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘

1. **åˆå§‹åŒ–ç¯å¢ƒ**
   ```bash
   git clone https://github.com/934050259/BrowserCluster.git
   cd browser-cluster
   uv sync
   uv run playwright install chromium
   ```

2. **é…ç½®æ•°æ®åº“**
   ä¿®æ”¹ `.env` é…ç½®æ–‡ä»¶ï¼ˆå‚è€ƒ `.env.example`ï¼‰ã€‚

3. **å¯åŠ¨æœåŠ¡**
   ```bash
   # å¯åŠ¨ API
   uv run uvicorn app.main:app --reload
   # å¯åŠ¨ Worker (æ¨èåœ¨ä¸åŒç»ˆç«¯æˆ–åå°è¿è¡Œ)
   uv run python scripts/run_worker.py
   ```

4. **å¯åŠ¨å‰ç«¯**
   ```bash
   cd admin && npm install && npm run dev
   ```

## ğŸ–¥ï¸ ç®¡ç†åå°åŠŸèƒ½è¯´æ˜

### 1. ä»»åŠ¡ç®¡ç† (Tasks)
- æ”¯æŒåŒæ­¥/å¼‚æ­¥æŠ“å–ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œã€‚
- è¯¦æƒ…é¡µå¯æŸ¥çœ‹æ¸²æŸ“æˆªå›¾ã€HTML æºç ã€æ‹¦æˆªçš„ API åˆ—è¡¨åŠ **Agent è¯†åˆ«ç»“è®º**ã€‚
- æ”¯æŒå…¨é“¾è·¯é‡è¯•åŠä»£ç†ã€æ¨¡å‹é…ç½®å›æº¯ã€‚

### 2. ä»£ç†ç®¡ç† (Proxy Pool)
- é›†ä¸­ç»´æŠ¤ä»£ç†èµ„äº§ï¼Œæ”¯æŒæ‰¹é‡å¯¼å…¥ã€‚
- **è¿æ¥æµ‹è¯•**ï¼šå†…ç½®æµè§ˆå™¨çº§åˆ«çš„ä»£ç†å¯ç”¨æ€§éªŒè¯ã€‚
- **åœºæ™¯å‚æ•°**ï¼šæ”¯æŒé…ç½® Sticky IP (ç²˜æ€§ä¼šè¯) å‘¨æœŸåŠå›½å®¶/åŸå¸‚å®šå‘ã€‚

### 3. Agent è®¾ç½® (LLM & Prompt)
- **æ¨¡å‹ç®¡ç†**ï¼šé…ç½® OpenAI, Anthropic, Gemini ç­‰ API å¯†é’¥ï¼Œæ”¯æŒä¸€é”®è¿æ¥æµ‹è¯•ã€‚
- **æç¤ºè¯ç®¡ç†**ï¼šæ„å»ºå¸¸ç”¨çš„æå–é€»è¾‘æ¨¡æ¿ï¼ˆå¦‚ï¼šç”µå•†å•†å“ä¿¡æ¯æå–ã€æ–°é—»æ‘˜è¦ç­‰ï¼‰ã€‚

## ğŸ“ ä»»åŠ¡å‚æ•°è¯´æ˜ (API /v1/scrape)

### params é…ç½®è¯¦è§£ (æ ¸å¿ƒ)

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `proxy` | object | `null` | ä»£ç†é…ç½®ï¼Œå¦‚ï¼š`{"server": "...", "username": "...", "password": "..."}` |
| `agent_enabled` | bool | `false` | æ˜¯å¦å¼€å¯ AI æ™ºèƒ½æå– |
| `agent_model_id` | string | `null` | æŒ‡å®šä½¿ç”¨çš„ LLM æ¨¡å‹ ID (éœ€åœ¨ç®¡ç†åå°é…ç½®) |
| `agent_prompt` | string | `null` | AI æå–æŒ‡ä»¤/è¦æ±‚ |
| `interaction_steps` | list | `[]` | æµè§ˆå™¨äº¤äº’æ­¥éª¤ (Skills)ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œæ»šåŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œ |
| `intercept_apis` | list | `[]` | æ¥å£æ‹¦æˆªæ¨¡å¼åˆ—è¡¨ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰ |
| `wait_for` | string | `networkidle` | ç­‰å¾…ç­–ç•¥ï¼š`networkidle`, `load`, `domcontentloaded` |
| `screenshot` | bool | `false` | æ˜¯å¦ç”Ÿæˆé¡µé¢æˆªå›¾ |
| `stealth` | bool | `true` | æ˜¯å¦å¯ç”¨åæ£€æµ‹ |

## ğŸ­ æµè§ˆå™¨äº¤äº’æŠ€èƒ½ (Browser Skills)

é€šè¿‡ `interaction_steps` å‚æ•°ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ç³»åˆ—é¢„ç½®æ“ä½œï¼Œç”¨äºå¤„ç†åŠ¨æ€å†…å®¹åŠ è½½ã€ç¿»é¡µæˆ–åœ°å›¾ç¼©æ”¾ã€‚

### å¸¸ç”¨æ“ä½œç±»å‹
- `scroll`: æ»šåŠ¨å®¹å™¨ã€‚å‚æ•°: `selector` (å®¹å™¨é€‰æ‹©å™¨, `window` è¡¨ç¤ºå…¨çª—å£), `distance` (æ»šåŠ¨è·ç¦»)ã€‚
- `infinite_scroll`: é«˜çº§æµå¼æ»šåŠ¨ã€‚å‚æ•°: `selector` (å®¹å™¨é€‰æ‹©å™¨), `max_scrolls` (æœ€å¤§æ»šåŠ¨æ¬¡æ•°), `delay` (æ¯æ¬¡åŠ è½½ç­‰å¾…æ—¶é—´)ã€‚
- `click`: ç‚¹å‡»å…ƒç´ ã€‚å‚æ•°: `selector` (å…ƒç´ é€‰æ‹©å™¨)ã€‚
- `pagination`: ç¿»é¡µã€‚å‚æ•°: `action` (`next`/`prev`), `selector` (å¯é€‰æŒ‰é’®é€‰æ‹©å™¨)ã€‚
- `zoom`: åœ°å›¾ç¼©æ”¾ã€‚å‚æ•°: `selector` (åœ°å›¾å®¹å™¨), `direction` (`in`/`out`), `times` (æ¬¡æ•°)ã€‚
- `wait`: é¢å¤–ç­‰å¾…ã€‚å‚æ•°: `duration` (æ¯«ç§’)ã€‚

### é€‰æ‹©å™¨èŒƒä¾‹ (Selector Examples)

| ç±»å‹ | èŒƒä¾‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| **åŸºç¡€** | `window` | å…¨å±æ»šåŠ¨ |
| **åŸºç¡€** | `#main-content` | æŒ‰ ID å®šä½å®¹å™¨ |
| **åŸºç¡€** | `.list-container` | æŒ‰ç±»åå®šä½æ»šåŠ¨åˆ—è¡¨ |
| **è¿›é˜¶** | `[data-testid="property-card"]` | æŒ‰å¼€å‘è€…å®šä¹‰çš„æµ‹è¯• ID å®šä½ï¼ˆæœ€ç¨³å¥ï¼‰ |
| **è¿›é˜¶** | `.search-results > ul` | å±‚çº§å®šä½ï¼šé€‰ä¸­ç»“æœé¢æ¿ä¸‹çš„ `ul` |
| **å¤æ‚** | `section:has(h2:text("æ¨è"))` | é€‰ä¸­åŒ…å«â€œæ¨èâ€æ–‡æœ¬æ ‡é¢˜çš„ `section` å®¹å™¨ |
| **å¤æ‚** | `div[class*="ScrollContainer"]` | æ¨¡ç³ŠåŒ¹é…ï¼šåŒ¹é…ç±»åä¸­åŒ…å« `ScrollContainer` çš„å…ƒç´  |

### ç¤ºä¾‹è¯·æ±‚ (å¤šæ­¥éª¤äº¤äº’ + AI æå–)

```json
{
  "url": "https://example.com/map",
  "params": {
    "interaction_steps": [
      { "action": "wait", "params": { "duration": 2000 } },
      { "action": "scroll", "params": { "selector": "window", "distance": 1000 } },
      { "action": "zoom", "params": { "selector": "#map", "direction": "in", "times": 2 } },
      { "action": "click", "params": { "selector": "button.show-more" } }
    ],
    "agent_enabled": true,
    "agent_prompt": "æå–å›¾ä¸­æ˜¾ç¤ºçš„æ‰€æœ‰åœ°ç‚¹åæ ‡åŠåç§°ã€‚"
  }
}
```

### ç¤ºä¾‹è¯·æ±‚ (æµå¼æ»šåŠ¨åŠ è½½æ›´å¤š)

```json
{
  "url": "https://social-media.com/feed",
  "params": {
    "interaction_steps": [
      { 
        "action": "infinite_scroll", 
        "params": { "selector": "window", "max_scrolls": 5, "delay": 2000 } 
      }
    ],
    "agent_enabled": true,
    "agent_prompt": "æå–åŠ è½½å‡ºæ¥çš„æ‰€æœ‰åŠ¨æ€å†…å®¹åŠå…¶å‘å¸ƒè€…ï¼Œè¦æ±‚æå–å‰ 50 æ¡è®°å½•ã€‚"
  }
}
```

## ğŸ“„ License

MIT
